# File dedicated to test real ACL use cases. This allow to test documentation
# exemple.

postgres:
  roles_query: null


acls:
  public:
    type: datacl
    inspect: |
      -- Returns public if no ACLs are defined in this database.
      WITH
      acls AS (
          SELECT
              (aclexplode(datacl)).grantee AS grantee,
              (aclexplode(datacl)).privilege_type AS priv
          FROM pg_catalog.pg_database
          WHERE datname = current_database()
      ),
      static AS (
          SELECT NULL AS namespace, 'public' AS rolname
      )
      SELECT static.*, TRUE as "full" FROM static
      LEFT OUTER JOIN acls ON acls.grantee = 0
      WHERE acls.grantee IS NULL;
    revoke: |
      REVOKE CONNECT ON DATABASE {database} FROM {role}

  ro:
  - __connect__
  - __select_on_tables__
  - __select_on_sequences__
  - __usage_on_schema__
  - __usage_on_types__

  rw:
  - __delete__
  - __execute__
  - __insert__
  - __references__
  - ro
  - __truncate__
  - __update_on_tables__
  - __update_on_sequences__


sync_map:
- grant:
    role: daniel
    acl: ro
    database: frontend
    schema: __all__
